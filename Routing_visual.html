<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="description" content="Visible A* search algorithm, fulfill by HTML5 canvas, concerntrate the performance in JavaScript">
    <meta name="author" content="Xiong Jie">
    <title>A* search algorithm in JavaScript</title>
    <link rel="stylesheet" type="text/css" href="testPage.css">
    <script type="text/javascript" src="./heuristic.js"></script>
    <script type="text/javascript" src="./minHeap.js"></script>
    <script type="text/javascript" src="./fibonacciHeap.js"></script>
    <script type="text/javascript" src="./tile.js"></script>
    <script type="text/javascript" src="./AStar.js"></script>
    <script type="text/javascript" src="./JPS.js"></script>
</head>

<body>
    <div class="size">
        Canvas size:
        <input type="text" id="canvasSize" value="720"> Grid scale:
        <input type="text" id="gridScale" value="180"> Percentage of obstacles
        <input type="text" id="obstaclePerc" value="0.99">
    </div>
    <div class="coordinate">
        <!-- It will randomly generate if not assigned.  -->
        Start point: x
        <input type="text" id="startX" value=""> y
        <input type="text" id="startY" value=""> End point: x
        <input type="text" id="endX" value=""> y
        <input type="text" id="endY" value="">
    </div>
    <div class="algorithm">
        Data structure setting:
        <form>
            <select id="dataStructure">
                <option value="binaryHeap">binary heap</option>
                <option value="fibonacciHeap">fibonacci heap</option>
            </select>
        </form>
    </div>
    <button type="button" onclick="init()">init</button>
    <button type="button" onclick="run()">run</button>

</body>

<script>
    var canvasSize, gridScale, obstaclePerc, startX, startY, endX, endY, ctx, startP, goalP, gridSize, tileSizemargin, start, goal;

    function init() {
        canvasSize = document.getElementById("canvasSize").value;
        gridScale = document.getElementById("gridScale").value;
        obstaclePerc = document.getElementById("obstaclePerc").value;
        startX = document.getElementById("startX").value;
        startY = document.getElementById("startY").value;
        endX = document.getElementById("endX").value;
        endY = document.getElementById("endY").value;

        var canvas = document.getElementById("routingMap");
        if (!canvas) {
            var canvas = document.createElement("canvas");
            canvas.id = "routingMap";
        }

        canvas.width = canvasSize;
        canvas.height = canvasSize;
        canvas.style.position = "absolute";
        canvas.style.top = "120px";
        canvas.style.left = "20px";
        canvas.style.border = "1px solid #000000";
        document.body.appendChild(canvas);

        startP = {
            x: startX ? startX : Math.floor(gridScale * Math.random()),
            y: startY ? startY : Math.floor(gridScale * Math.random())
        };
        goalP = {
            x: endX ? endX : Math.floor(gridScale * Math.random()),
            y: endY ? endY : Math.floor(gridScale * Math.random())
        };

        ctx = canvas.getContext("2d");

        gridSize = canvasSize / gridScale;
        tileSize = gridSize * 0.8;
        margin = gridSize * 0.1;

        ctx.fillStyle = "LightGray";

        var grids = [];
        for (var h = 0; h < gridScale; h++) {
            grids[h] = [];
            for (var v = 0; v < gridScale; v++) {
                grids[h][v] = (Math.random() > obstaclePerc) ? 0 : 1;
            }
        }

        initSearchGrid(grids);

        grids.forEach(function(value, i) {
            value.forEach(function(t, j) {
                if (t) {
                    ctx.fillRect(margin + i * gridSize, margin + j * gridSize, tileSize, tileSize);
                } else {
                    ctx.fillStyle = "red";
                    ctx.fillRect(margin + i * gridSize, margin + j * gridSize, tileSize, tileSize);
                    ctx.fillStyle = "LightGray";
                }
            })
        });

        start = getNode(startP.x, startP.y);
        goal = getNode(goalP.x, goalP.y);
        ctx.fillStyle = "green";
        ctx.fillRect(margin + start.x * gridSize, margin + start.y * gridSize, tileSize, tileSize);
        ctx.fillRect(margin + goal.x * gridSize, margin + goal.y * gridSize, tileSize, tileSize);
    }

    function run() {
        var path = aStar(start, goal, manhattan);

        ctx.fillStyle = "orange";
        path.forEach(function(value) {
            ctx.fillRect(margin + value.x * gridSize, margin + value.y * gridSize, tileSize, tileSize);
        });
        ctx.fillStyle = "green";
        ctx.fillRect(margin + start.x * gridSize, margin + start.y * gridSize, tileSize, tileSize);
        ctx.fillRect(margin + goal.x * gridSize, margin + goal.y * gridSize, tileSize, tileSize);
    }

</script>

</html>